<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Subject Details</title>
  <!-- Favicon -->
<link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%3E%3Crect%20width='100'%20height='100'%20fill='%2360a5fa'/%3E%3Ctext%20x='50'%20y='68'%20font-size='48'%20font-family='Arial'%20fill='%2304263b'%20text-anchor='middle'%20font-weight='700'%3EST%3C/text%3E%3C/svg%3E">
<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%3E%3Crect%20width='100'%20height='100'%20fill='%2360a5fa'/%3E%3Ctext%20x='50'%20y='68'%20font-size='48'%20font-family='Arial'%20fill='%2304263b'%20text-anchor='middle'%20font-weight='700'%3EST%3C/text%3E%3C/svg%3E">
<meta name="theme-color" content="#60a5fa">

<style>
  :root{
    --bg:#0f1724;
    --muted:#94a3b8;
    --accent1:#60a5fa;
    --accent2:#fbbf24;
    --accent3:#34d399;
    --accent4:#f472b6;
    --accent5:#f87171;
    --accent6:#818cf8;
    --accent7:#22d3ee;
    --accent8:#a78bfa;
    --card-bg: rgba(255,255,255,0.03);
  }

  body {
    margin:0;
    font-family: Inter, system-ui, Arial;
    background: linear-gradient(180deg,#071127,#071726);
    color: #e6eef8;
    padding: 20px;
  }

  h1 { margin-top:0; font-size:24px; }

  .progress-wrap {
    width:100%;
    height:20px;
    background: rgba(255,255,255,0.05);
    border-radius:12px;
    overflow:hidden;
    margin: 12px 0;
  }

  .progress-bar {
    height:100%;
    width:0%;
    border-radius:12px;
    transition: width 0.3s ease;
  }

  .chapter {
    display:flex;
    align-items:center;
    gap:8px;
    margin-bottom:8px;
    background: var(--card-bg);
    padding:8px;
    border-radius:8px;
  }

  input[type="checkbox"] { width:18px; height:18px; }
  input[type="text"] { flex:1; padding:6px; border-radius:6px; border:none; background:#0b1220; color:inherit; }
  .small { font-size:13px; color:var(--muted); margin-top:6px; }

  .chapters { margin-top:14px; }
  .subject-color { padding:4px 8px; border-radius:4px; font-size:13px; font-weight:600; color:#04263b; margin-right:8px; }
</style>
</head>
<body>
<h1 id="subjectName">Subject Name</h1>
<div class="progress-wrap"><div id="progressBar" class="progress-bar"></div></div>
<div id="progressText" class="small">0 / 0 (0%)</div>

<div class="chapters" id="chaptersList"></div>

<script>
const LS_SUBJECTS = 'study_subjects_v1';
let subjects = JSON.parse(localStorage.getItem(LS_SUBJECTS)) || [];

// Map subject names to chapter counts
const chaptersCountMap = {
  'Accounting': 15,
  'Income Tax': 9,
  'GST': 15,
  'Law': 15,
  'Costing': 15,
  'Financial Management': 9,
  'Strategic Management': 5,
  'Auditing': 11
};

// Colors for subjects
const colors = [
  'var(--accent1)','var(--accent2)','var(--accent3)','var(--accent4)',
  'var(--accent5)','var(--accent6)','var(--accent7)','var(--accent8)',
  'var(--accent1)','var(--accent2)','var(--accent3)','var(--accent4)',
  'var(--accent5)','var(--accent6)','var(--accent7)'
];

// Get subject index from URL
const params = new URLSearchParams(window.location.search);
const idx = parseInt(params.get('idx'),10);
if(isNaN(idx)||idx<0||idx>=subjects.length){ document.body.innerHTML="<p>Subject not found.</p>"; throw new Error('Subject not found'); }
let subject = subjects[idx];

// Create chapters if missing
const nChapters = chaptersCountMap[subject.name] || subject.chapters || 8;
if(!Array.isArray(subject.chaptersList) || subject.chaptersList.length !== nChapters){
  subject.chaptersList = Array.from({length:nChapters},(_,i)=>({name:`Chapter ${i+1}`,done:false}));
  subject.chapters = nChapters;
  subject.completed = 0;
  subjects[idx] = subject;
  localStorage.setItem(LS_SUBJECTS,JSON.stringify(subjects));
}

const chaptersListEl = document.getElementById('chaptersList');
const progressBar = document.getElementById('progressBar');
const progressText = document.getElementById('progressText');
document.getElementById('subjectName').textContent = subject.name;

// Apply color based on subject index
progressBar.style.background = colors[idx%colors.length];

function renderChapters(){
  chaptersListEl.innerHTML='';
  subject.chaptersList.forEach((c,i)=>{
    const div=document.createElement('div');
    div.className='chapter';
    div.innerHTML = `
      <span class="subject-color" style="background:${colors[idx%colors.length]}">${i+1}</span>
      <input type="checkbox" data-i="${i}" ${c.done?'checked':''}>
      <input type="text" value="${c.name}" data-i="${i}">
    `;
    chaptersListEl.appendChild(div);
  });
  updateProgress();
}

function updateProgress(){
  const done = subject.chaptersList.filter(c=>c.done).length;
  const total = subject.chaptersList.length;
  const pct = total? Math.round((done/total)*100):0;
  progressBar.style.width = pct+'%';
  progressText.textContent = `${done} / ${total} (${pct}%)`;

  subject.completed = done;
  subjects[idx] = subject;
  localStorage.setItem(LS_SUBJECTS,JSON.stringify(subjects));
}

// Event delegation for checkbox and text changes
chaptersListEl.addEventListener('input',(e)=>{
  if(e.target.type==='checkbox'){
    const i = +e.target.dataset.i;
    subject.chaptersList[i].done = e.target.checked;
    updateProgress();
  }
  if(e.target.type==='text'){
    const i = +e.target.dataset.i;
    subject.chaptersList[i].name = e.target.value;
    subjects[idx] = subject;
    localStorage.setItem(LS_SUBJECTS,JSON.stringify(subjects));
  }
});

renderChapters();
</script>
</body>
</html>
